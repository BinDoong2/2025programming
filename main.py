import streamlit as st
import pandas as pd
from collections import defaultdict

# ë°ì´í„° ë¡œë“œ
@st.cache_data
def load_data():
    df = pd.read_csv('games.csv')
    return df

games_df = load_data()

# --- UI ë° ì„¤ë¬¸ êµ¬ì„± ---
st.title('ğŸ¯ ë‚˜ì˜ í•µì‹¬ ê²Œì„ ì¥ë¥´ ì°¾ê¸°')
st.write('ì´ 12ê°œì˜ ì§ˆë¬¸ì— ë‹µí•˜ê³ , ë‹¹ì‹ ì˜ í”Œë ˆì´ ì„±í–¥ì— ë”± ë§ëŠ” í•µì‹¬ ì¥ë¥´ì™€ ê²Œì„ì„ ì¶”ì²œë°›ìœ¼ì„¸ìš”!')

# 12ê°œì˜ ì„¤ë¬¸ ë¬¸í•­
questions = {
    "q1": ("ìƒˆë¡œìš´ ê²Œì„ì„ ì‹œì‘í•  ë•Œ, ê°€ì¥ ë¨¼ì € ë¬´ì—‡ì— ëŒë¦¬ì‹œë‚˜ìš”?", 
           ("ëª°ì…ê° ë†’ì€ ìŠ¤í† ë¦¬ì™€ ì„¸ê³„ê´€", "ë¹ ë¥¸ ì•¡ì…˜ê³¼ íƒ€ê²©ê°", "ê³ ë¯¼ì´ í•„ìš”í•œ ì „ëµê³¼ í¼ì¦", "ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ì˜ ìƒí˜¸ì‘ìš©")),
    "q2": ("ê²Œì„ í”Œë ˆì´ ì¤‘ ê°€ì¥ í° ë§Œì¡±ì„ ëŠë‚„ ë•ŒëŠ” ì–¸ì œì¸ê°€ìš”?", 
           ("ê°•ë ¥í•œ ë³´ìŠ¤ë¥¼ ì“°ëŸ¬ëœ¨ë ¸ì„ ë•Œ", "ë‚˜ë§Œì˜ ê³µê°„ì´ë‚˜ ìºë¦­í„°ë¥¼ ê¾¸ë°€ ë•Œ", "ë³µì¡í•œ ë¬¸ì œë¥¼ í•´ê²°í–ˆì„ ë•Œ", "íŒ€ì›ê³¼ í˜‘ë ¥í•˜ì—¬ ìŠ¹ë¦¬í–ˆì„ ë•Œ")),
    "q3": ("ì„ í˜¸í•˜ëŠ” ê²Œì„ì˜ ì§„í–‰ ì†ë„ëŠ” ì–´ë–¤ê°€ìš”?", 
           ("ë¹ ë¥´ê³  ìˆ¨ ì‰´ í‹ˆ ì—†ëŠ” ì „ê°œ", "ë‚´ í˜ì´ìŠ¤ëŒ€ë¡œ ì¦ê¸°ëŠ” ì—¬ìœ ë¡œìš´ í”Œë ˆì´", "ì‹ ì¤‘í•œ ê³„íšì´ ìš”êµ¬ë˜ëŠ” í„´(Turn) ë°©ì‹", "ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•˜ê³  ë§¤ë²ˆ ë‹¤ë¥¸ ê²½í—˜")),
    "q4": ("ê²Œì„ì—ì„œ ì‹¤íŒ¨(ì£½ìŒ ë“±)í–ˆì„ ë•Œ ì–´ë–¤ ê°ì •ì„ ëŠë¼ë‚˜ìš”?", 
           ("ì„±ì¥ì˜ ë°‘ê±°ë¦„! ë” ê°•í•´ì ¸ì„œ ëŒì•„ì˜¨ë‹¤", "ê´œì°®ì•„, ë‹¤ë¥¸ ê±¸ í•˜ë©´ ë¼", "íŒ¨ë°° ì›ì¸ì„ ë¶„ì„í•˜ê³  ë‹¤ìŒ ìˆ˜ë¥¼ ìƒê°í•œë‹¤", "ì•„ì‰½ì§€ë§Œ, íŒ€ì›ë“¤ê³¼ ë‹¤ìŒì„ ê¸°ì•½í•œë‹¤")),
    "q5": ("ê²Œì„ì—ì„œ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ìš”ì†ŒëŠ” ë¬´ì—‡ì¸ê°€ìš”?", 
           ("ë§¤ë ¥ì ì¸ ìºë¦­í„°ì™€ ê°ë™ì ì¸ ì„œì‚¬", "ì •êµí•œ ì»¨íŠ¸ë¡¤ê³¼ ì¦‰ê°ì ì¸ í”¼ë“œë°±", "ìì› ê´€ë¦¬ì™€ íš¨ìœ¨ì ì¸ ì„±ì¥", "ë‹¤ë¥¸ í”Œë ˆì´ì–´ì™€ì˜ ê²½ìŸ ë˜ëŠ” í˜‘ë ¥")),
    "q6": ("ì–´ë–¤ ì¢…ë¥˜ì˜ ë„ì „ì„ ì¦ê¸°ì‹œë‚˜ìš”?", 
           ("ê°•ë ¥í•œ ì ë“¤ê³¼ì˜ ì „íˆ¬", "ì°½ì˜ë ¥ì„ ë°œíœ˜í•˜ëŠ” ê±´ì„¤ê³¼ ì œì‘", "ë‘ë‡Œë¥¼ ìê·¹í•˜ëŠ” í¼ì¦ê³¼ ìˆ˜ìˆ˜ê»˜ë¼", "ì˜ˆì¸¡ë¶ˆí—ˆì˜ ìƒí™©ê³¼ ìƒì¡´ ê²½ìŸ")),
    "q7": ("ê²Œì„ì˜ ìŠ¤í† ë¦¬ë¥¼ ì¦ê¸°ëŠ” ë°©ì‹ì€ ì–´ë–¤ê°€ìš”?", 
           ("ì£¼ì¸ê³µì´ ë˜ì–´ ìŠ¤í† ë¦¬ë¥¼ ì§ì ‘ ì´ëŒì–´ê°„ë‹¤", "í•œ í¸ì˜ ì˜í™”ë‚˜ ì†Œì„¤ì²˜ëŸ¼ ê°ìƒí•œë‹¤", "ìŠ¤í† ë¦¬ë³´ë‹¤ëŠ” ê²Œì„ì˜ ê·œì¹™ê³¼ ì‹œìŠ¤í…œì´ ë” ì¬ë°Œë‹¤", "ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ê³¼ í•¨ê»˜ ë§Œë“¤ì–´ê°€ëŠ” ì´ì•¼ê¸°")),
    "q8": ("ì„ í˜¸í•˜ëŠ” ê²Œì„ì˜ ë¹„ì£¼ì–¼ ìŠ¤íƒ€ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?", 
           ("í˜„ì‹¤ì ì¸ ê·¸ë˜í”½ê³¼ ë¶„ìœ„ê¸°", "ê°œì„± ìˆëŠ” ì•„íŠ¸ ìŠ¤íƒ€ì¼ê³¼ íŒíƒ€ì§€ ì„¸ê³„", "ì •ë³´ê°€ ëª…í™•í•˜ê²Œ ë³´ì´ëŠ” ê¹”ë”í•œ ì¸í„°í˜ì´ìŠ¤", "ë‹¤ì–‘í•œ ì½”ìŠ¤íŠ¬ê³¼ ê¾¸ë¯¸ê¸° ìš”ì†Œ")),
    "q9": ("ê²Œì„ì„ í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê¸°ê¸°ëŠ” ë¬´ì—‡ì¸ê°€ìš”?", 
           ("í‚¤ë³´ë“œì™€ ë§ˆìš°ìŠ¤ (PC)", "ê²Œì„ íŒ¨ë“œ (ì½˜ì†”/PC)", "í„°ì¹˜ìŠ¤í¬ë¦° (ëª¨ë°”ì¼)", "ìƒê´€ì—†ìŒ")),
    "q10": ("ì–¼ë§ˆë‚˜ ë§ì€ ì‹œê°„ì„ í•˜ë‚˜ì˜ ê²Œì„ì— íˆ¬ìí•˜ëŠ” í¸ì¸ê°€ìš”?", 
           ("ìˆ˜ë°± ì‹œê°„ ì´ìƒ ê¹Šê²Œ íŒŒê³ ë“œëŠ” í¸", "ì—”ë”©ì„ ë³´ê³  ë‹¤ë¥¸ ê²Œì„ì„ ì°¾ì•„ë³´ëŠ” í¸", "ì§§ì€ ì‹œê°„ ë™ì•ˆ ê°€ë³ê²Œ ì¦ê¸°ëŠ” í¸", "ì»¤ë®¤ë‹ˆí‹° í™œë™ê¹Œì§€ í•˜ë©° ê³„ì† ì¦ê¸°ëŠ” í¸")),
    "q11": ("ë‹¤ìŒ ì¤‘ ê°€ì¥ í¥ë¯¸ë¡œìš´ í™œë™ì€ ë¬´ì—‡ì¸ê°€ìš”?", 
           ("ë¯¸ì§€ì˜ ì„¸ê³„ë¥¼ íƒí—˜í•˜ê³  ë¹„ë°€ì„ ë°íˆëŠ” ê²ƒ", "ìµœê³ ì˜ ì¥ë¹„ë¥¼ ë§ì¶”ê³  ìºë¦­í„°ë¥¼ ì„±ì¥ì‹œí‚¤ëŠ” ê²ƒ", "ë‚˜ë§Œì˜ ì œêµ­ì´ë‚˜ ë„ì‹œë¥¼ ê±´ì„¤í•˜ê³  ìš´ì˜í•˜ëŠ” ê²ƒ", "ë­í‚¹ì„ ì˜¬ë¦¬ê±°ë‚˜ ê¸¸ë“œ í™œë™ì„ í•˜ëŠ” ê²ƒ")),
    "q12": ("ê²Œì„ ì»¤ë®¤ë‹ˆí‹°(ê³µëµ ì‚¬ì´íŠ¸, í¬ëŸ¼ ë“±)ë¥¼ ì–¼ë§ˆë‚˜ í™œìš©í•˜ì‹œë‚˜ìš”?", 
           ("ì ê·¹ì ìœ¼ë¡œ ì •ë³´ë¥¼ ì°¾ê³  ê³µìœ í•œë‹¤", "ë§‰í ë•Œë§Œ ê°€ë” ì°¾ì•„ë³¸ë‹¤", "ê±°ì˜ ë³´ì§€ ì•Šê³  í˜¼ì í•´ê²°í•œë‹¤", "ë‹¤ë¥¸ ì‚¬ëŒê³¼ ì†Œí†µí•˜ê¸° ìœ„í•´ í•­ìƒ ì´ìš©í•œë‹¤"))
}

# ì‚¬ìš©ì ë‹µë³€ ì €ì¥
answers = {}
for q_id, (question, options) in questions.items():
    st.subheader(question)
    answers[q_id] = st.radio(f"radio_{q_id}", options, label_visibility="collapsed")

# --- ì¶”ì²œ ë¡œì§ ---
if st.button('ë‚´ê²Œ ë§ëŠ” ì¥ë¥´ì™€ ê²Œì„ í™•ì¸í•˜ê¸°'):
    # 1. ì„±í–¥ ì ìˆ˜ ì´ˆê¸°í™”
    traits = defaultdict(int)

    # 2. ë‹µë³€ì— ë”°ë¼ ì„±í–¥ ì ìˆ˜ ë¶€ì—¬
    # (ì§ˆë¬¸, ë‹µë³€) -> ì„±í–¥ ì ìˆ˜ ë§¤í•‘
    score_map = {
        'q1': {'ëª°ì…ê° ë†’ì€ ìŠ¤í† ë¦¬ì™€ ì„¸ê³„ê´€': 'ìŠ¤í† ë¦¬', 'ë¹ ë¥¸ ì•¡ì…˜ê³¼ íƒ€ê²©ê°': 'ì•¡ì…˜ì„±', 'ê³ ë¯¼ì´ í•„ìš”í•œ ì „ëµê³¼ í¼ì¦': 'ì „ëµì„±', 'ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ì˜ ìƒí˜¸ì‘ìš©': 'ì‚¬êµì„±'},
        'q2': {'ê°•ë ¥í•œ ë³´ìŠ¤ë¥¼ ì“°ëŸ¬ëœ¨ë ¸ì„ ë•Œ': 'ì•¡ì…˜ì„±', 'ë‚˜ë§Œì˜ ê³µê°„ì´ë‚˜ ìºë¦­í„°ë¥¼ ê¾¸ë°€ ë•Œ': 'ì°½ì˜ì„±', 'ë³µì¡í•œ ë¬¸ì œë¥¼ í•´ê²°í–ˆì„ ë•Œ': 'ì „ëµì„±', 'íŒ€ì›ê³¼ í˜‘ë ¥í•˜ì—¬ ìŠ¹ë¦¬í–ˆì„ ë•Œ': 'ì‚¬êµì„±'},
        'q3': {'ë¹ ë¥´ê³  ìˆ¨ ì‰´ í‹ˆ ì—†ëŠ” ì „ê°œ': 'ì•¡ì…˜ì„±', 'ë‚´ í˜ì´ìŠ¤ëŒ€ë¡œ ì¦ê¸°ëŠ” ì—¬ìœ ë¡œìš´ í”Œë ˆì´': 'ì°½ì˜ì„±', 'ì‹ ì¤‘í•œ ê³„íšì´ ìš”êµ¬ë˜ëŠ” í„´(Turn) ë°©ì‹': 'ì „ëµì„±', 'ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•˜ê³  ë§¤ë²ˆ ë‹¤ë¥¸ ê²½í—˜': 'ëª¨í—˜ì„±'},
        'q4': {'ì„±ì¥ì˜ ë°‘ê±°ë¦„! ë” ê°•í•´ì ¸ì„œ ëŒì•„ì˜¨ë‹¤': 'ì•¡ì…˜ì„±', 'ê´œì°®ì•„, ë‹¤ë¥¸ ê±¸ í•˜ë©´ ë¼': 'ì°½ì˜ì„±', 'íŒ¨ë°° ì›ì¸ì„ ë¶„ì„í•˜ê³  ë‹¤ìŒ ìˆ˜ë¥¼ ìƒê°í•œë‹¤': 'ì „ëµì„±', 'ì•„ì‰½ì§€ë§Œ, íŒ€ì›ë“¤ê³¼ ë‹¤ìŒì„ ê¸°ì•½í•œë‹¤': 'ì‚¬êµì„±'},
        'q5': {'ë§¤ë ¥ì ì¸ ìºë¦­í„°ì™€ ê°ë™ì ì¸ ì„œì‚¬': 'ìŠ¤í† ë¦¬', 'ì •êµí•œ ì»¨íŠ¸ë¡¤ê³¼ ì¦‰ê°ì ì¸ í”¼ë“œë°±': 'ì•¡ì…˜ì„±', 'ìì› ê´€ë¦¬ì™€ íš¨ìœ¨ì ì¸ ì„±ì¥': 'ì „ëµì„±', 'ë‹¤ë¥¸ í”Œë ˆì´ì–´ì™€ì˜ ê²½ìŸ ë˜ëŠ” í˜‘ë ¥': 'ì‚¬êµì„±'},
        'q6': {'ê°•ë ¥í•œ ì ë“¤ê³¼ì˜ ì „íˆ¬': 'ì•¡ì…˜ì„±', 'ì°½ì˜ë ¥ì„ ë°œíœ˜í•˜ëŠ” ê±´ì„¤ê³¼ ì œì‘': 'ì°½ì˜ì„±', 'ë‘ë‡Œë¥¼ ìê·¹í•˜ëŠ” í¼ì¦ê³¼ ìˆ˜ìˆ˜ê»˜ë¼': 'ì „ëµì„±', 'ì˜ˆì¸¡ë¶ˆí—ˆì˜ ìƒí™©ê³¼ ìƒì¡´ ê²½ìŸ': 'ëª¨í—˜ì„±'},
        'q7': {'ì£¼ì¸ê³µì´ ë˜ì–´ ìŠ¤í† ë¦¬ë¥¼ ì§ì ‘ ì´ëŒì–´ê°„ë‹¤': 'ìŠ¤í† ë¦¬', 'í•œ í¸ì˜ ì˜í™”ë‚˜ ì†Œì„¤ì²˜ëŸ¼ ê°ìƒí•œë‹¤': 'ìŠ¤í† ë¦¬', 'ìŠ¤í† ë¦¬ë³´ë‹¤ëŠ” ê²Œì„ì˜ ê·œì¹™ê³¼ ì‹œìŠ¤í…œì´ ë” ì¬ë°Œë‹¤': 'ì „ëµì„±', 'ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ê³¼ í•¨ê»˜ ë§Œë“¤ì–´ê°€ëŠ” ì´ì•¼ê¸°': 'ì‚¬êµì„±'},
        'q8': {'í˜„ì‹¤ì ì¸ ê·¸ë˜í”½ê³¼ ë¶„ìœ„ê¸°': 'ëª¨í—˜ì„±', 'ê°œì„± ìˆëŠ” ì•„íŠ¸ ìŠ¤íƒ€ì¼ê³¼ íŒíƒ€ì§€ ì„¸ê³„': 'ìŠ¤í† ë¦¬', 'ì •ë³´ê°€ ëª…í™•í•˜ê²Œ ë³´ì´ëŠ” ê¹”ë”í•œ ì¸í„°í˜ì´ìŠ¤': 'ì „ëµì„±', 'ë‹¤ì–‘í•œ ì½”ìŠ¤íŠ¬ê³¼ ê¾¸ë¯¸ê¸° ìš”ì†Œ': 'ì°½ì˜ì„±'},
        'q9': {'í‚¤ë³´ë“œì™€ ë§ˆìš°ìŠ¤ (PC)': 'ì „ëµì„±', 'ê²Œì„ íŒ¨ë“œ (ì½˜ì†”/PC)': 'ì•¡ì…˜ì„±', 'í„°ì¹˜ìŠ¤í¬ë¦° (ëª¨ë°”ì¼)': 'ì°½ì˜ì„±', 'ìƒê´€ì—†ìŒ': 'ëª¨í—˜ì„±'},
        'q10': {'ìˆ˜ë°± ì‹œê°„ ì´ìƒ ê¹Šê²Œ íŒŒê³ ë“œëŠ” í¸': 'ì „ëµì„±', 'ì—”ë”©ì„ ë³´ê³  ë‹¤ë¥¸ ê²Œì„ì„ ì°¾ì•„ë³´ëŠ” í¸': 'ìŠ¤í† ë¦¬', 'ì§§ì€ ì‹œê°„ ë™ì•ˆ ê°€ë³ê²Œ ì¦ê¸°ëŠ” í¸': 'ì•¡ì…˜ì„±', 'ì»¤ë®¤ë‹ˆí‹° í™œë™ê¹Œì§€ í•˜ë©° ê³„ì† ì¦ê¸°ëŠ” í¸': 'ì‚¬êµì„±'},
        'q11': {'ë¯¸ì§€ì˜ ì„¸ê³„ë¥¼ íƒí—˜í•˜ê³  ë¹„ë°€ì„ ë°íˆëŠ” ê²ƒ': 'ëª¨í—˜ì„±', 'ìµœê³ ì˜ ì¥ë¹„ë¥¼ ë§ì¶”ê³  ìºë¦­í„°ë¥¼ ì„±ì¥ì‹œí‚¤ëŠ” ê²ƒ': 'ì•¡ì…˜ì„±', 'ë‚˜ë§Œì˜ ì œêµ­ì´ë‚˜ ë„ì‹œë¥¼ ê±´ì„¤í•˜ê³  ìš´ì˜í•˜ëŠ” ê²ƒ': 'ì „ëµì„±', 'ë­í‚¹ì„ ì˜¬ë¦¬ê±°ë‚˜ ê¸¸ë“œ í™œë™ì„ í•˜ëŠ” ê²ƒ': 'ì‚¬êµì„±'},
        'q12': {'ì ê·¹ì ìœ¼ë¡œ ì •ë³´ë¥¼ ì°¾ê³  ê³µìœ í•œë‹¤': 'ì „ëµì„±', 'ë§‰í ë•Œë§Œ ê°€ë” ì°¾ì•„ë³¸ë‹¤': 'ìŠ¤í† ë¦¬', 'ê±°ì˜ ë³´ì§€ ì•Šê³  í˜¼ì í•´ê²°í•œë‹¤': 'ëª¨í—˜ì„±', 'ë‹¤ë¥¸ ì‚¬ëŒê³¼ ì†Œí†µí•˜ê¸° ìœ„í•´ í•­ìƒ ì´ìš©í•œë‹¤': 'ì‚¬êµì„±'}
    }
    
    for q_id, answer in answers.items():
        trait = score_map[q_id][answer]
        traits[trait] += 1
    
    # 3. ìµœê³  ì„±í–¥ê³¼ í•µì‹¬ ì¥ë¥´ ê²°ì •
    # ì„±í–¥ -> í•µì‹¬ ì¥ë¥´ ë§¤í•‘
    trait_to_genre = {
        'ìŠ¤í† ë¦¬': 'RPG',
        'ì•¡ì…˜ì„±': 'Action',
        'ì „ëµì„±': 'Strategy',
        'ì‚¬êµì„±': 'Multiplayer',
        'ì°½ì˜ì„±': 'Simulation',
        'ëª¨í—˜ì„±': 'Adventure'
    }
    
    if not traits:
         st.warning("ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ì§ˆë¬¸ì— ë‹µë³€í•´ì£¼ì„¸ìš”.")
    else:
        top_trait = max(traits, key=traits.get)
        recommended_genre = trait_to_genre[top_trait]

        # 4. ê²°ê³¼ ì¶œë ¥
        st.subheader(f'"{top_trait}" ì„±í–¥ì˜ ë‹¹ì‹ ì„ ìœ„í•œ ì¶”ì²œ')
        st.success(f"### ë‹¹ì‹ ì˜ í•µì‹¬ ê²Œì„ ì¥ë¥´ëŠ” **{recommended_genre}** ì…ë‹ˆë‹¤!")

        # 5. ì¼ê´€ì„± ìˆëŠ” ê²Œì„ ì¶”ì²œ
        # ì¶”ì²œ ì¥ë¥´ê°€ ê²Œì„ ì¥ë¥´ ëª©ë¡ì˜ ë§¨ ì•ì— ìœ„ì¹˜í• ìˆ˜ë¡ ê°€ì¤‘ì¹˜ë¥¼ ë¶€ì—¬
        def get_relevance_score(game_genres_str):
            game_genres = game_genres_str.split(';')
            if recommended_genre in game_genres:
                try:
                    # í•µì‹¬ ì¥ë¥´ê°€ ì•ì— ìˆì„ìˆ˜ë¡ ë†’ì€ ì ìˆ˜ (ì—­ìˆœ ì¸ë±ìŠ¤)
                    return len(game_genres) - game_genres.index(recommended_genre)
                except ValueError:
                    return 0
            return 0
        
        games_df['relevance'] = games_df['genres'].apply(get_relevance_score)
        
        # ê´€ë ¨ë„ ì ìˆ˜ê°€ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ê³  ìƒìœ„ 5ê°œ ì¶”ì²œ
        recommended_games = games_df[games_df['relevance'] > 0].sort_values(by='relevance', ascending=False).head(5)

        st.subheader("ğŸ¯ ì¶”ì²œ ê²Œì„ ëª©ë¡")
        if recommended_games.empty:
            st.info('ì•„ì‰½ì§€ë§Œ í˜„ì¬ ë°ì´í„°ì— ì¶”ì²œí•  ë§Œí•œ ê²Œì„ì´ ì—†ë„¤ìš”.')
        else:
            for _, row in recommended_games.iterrows():
                st.markdown(f"**{row['title']}** (ì¥ë¥´: {row['genres'].replace(';', ', ')})")
